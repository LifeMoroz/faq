{% load staticfiles %}
<!DOCTYPE html>
<html>
<head>
    <title>{{ project_name }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css">

    <!-- Optional theme -->
    {#    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap-theme.min.css">#}

    <!-- project css -->
    <link rel="stylesheet" href="{% static "css/style.css" %}">
</head>
<body>
<!-- Static navbar -->
<div class="navbar navbar-default navbar-static-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">{{ project_name }}</a>
        </div>
        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li {% if active == "index"%} class="active"{% endif %}><a href="/">New</a></li>
                <li {% if active == "popular"%} class="active"{% endif %}><a href="/popular">Popular</a></li>
                {% if user.is_authenticated %}
                    <li class="ask-button"><a href="#ask" data-toggle="modal" data-target="#ask">Ask</a></li>
                {% endif %}
            </ul>
            <ul class="nav navbar-nav navbar-right">
                {% if user.is_authenticated %}
                    <li><a href="#">{{ user.username }}</a></li>
                    <li><a href="/logout"><span class="glyphicon glyphicon-log-out"></span> logout</a></li>
                {% else %}
                    <li><a href="/register{% if not noredirect %}?redirect={{ request.get_full_path }}{% endif %}"><span class="glyphicon glyphicon-check"></span> register</a></li>
                    <li><a href="/login{% if not noredirect %}?redirect={{ request.get_full_path }}{% endif %}"><span class="glyphicon glyphicon-log-in"></span> login</a></li>
                {% endif %}
            </ul>
        </div>
        <!--/.nav-collapse -->
    </div>
</div>


<div class="container">
    <div class="row">
        <div class="col-md-9">
        {% block content %}
            <!-- Main component for a primary marketing message or call to action -->
            <div class="jumbotron">
                <h1>Navbar example</h1>

                <p>This example is a quick exercise to illustrate how the default, static and fixed to top navbar work. It
                    includes the responsive CSS and HTML, so it also adapts to your viewport and device.</p>

                <p>To see the difference between static and fixed top navbars, just scroll.</p>

                <p>
                    <a class="btn btn-lg btn-primary" href="../../components/#navbar" role="button">View navbar docs Â»</a>
                </p>
            </div>
        {% endblock %}
        </div>
        <div class="col-md-3">
            <div class="panel panel-default">
                <div class="panel-heading">last users</div>
                <div class="panel-conent">
                <ul>
                {% for user in last_users %}
                  <li>
                    <a href="{{ user.get_absolute_url }}">{{ user.username }}</a>
                  </li>
                {% endfor %}
                </ul>
            </div>
        </div>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="ask" tabindex="-1" role="dialog" aria-labelledby="ask-label" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="ask-label">Ask</h4>
                </div>
                <div class="modal-body" id="ask_form_html">
                    {% include "ask.html" %}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="ask_form_button">Ask</button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
    <!-- /.modal -->

</div>
<!-- /container -->


<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="{% static "js/jquery-1.10.2.min.js" %}" type="text/javascript"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="{% static "js/bootstrap.js" %}"></script>

<script type="text/javascript">
    // using jQuery
    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie != '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = jQuery.trim(cookies[i]);
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) == (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    var csrftoken = getCookie('csrftoken');
    
    $('#ask_form_button').click(function () {
        $.post('/ask', $('form#ask_form').serialize(), function (data) {
                    if (data.status == 'ok') {
                        window.location.replace(data.url);
                    } else {
                        $('#ask_form_html').html(data.html);
                    }
                }
        );
    });

    $('.votelink').click(function(e) {
        e.preventDefault();
        var url = $(this).data('link');
        $.post(url, {'csrfmiddlewaretoken': csrftoken}, function(data) {
            if (data.status == 'ok')
                location.reload()
            console.log(data);
        });
    });
    
    $('.message').bind('closed.bs.alert', function () {
        console.log($(this).data('dismiss_url'));
        var url = $(this).data('dismiss_url');
        $.post(url, {'csrfmiddlewaretoken': csrftoken}, function(data) {
            if (data.status == 'ok')
                console.log('Message dismissed!')
            console.log(data);
        });        
    })
   
</script>
</body>
</html>
